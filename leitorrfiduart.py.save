#!/usr/bin/env python
#import serial
import RPi.GPIO as GPIO
#import sys
import time
#import pigpio
#import vw
#import string
#import rdm6300 as rfid
#import os


#baudrate = 9600

#txPin=24
aviso=0
rxPin=21
id=[]
count_byte=0
count_nobyte=0

GPIO.setmode(GPIO.BCM)

GPIO.setup(rxPin, GPIO.IN)

#serialpi=pigpio.pi()
#serialpi.set_mode(rxPin,pigpio.INPUT)
#serialpi.set_mode(txPin,pigpio.OUTPUT)




def Sendline(serialpi):
    serialpi.wave_clear()
    serialpi.wave_add_serial(txPin,baudrate,b'8')
    wid=serialpi.wave_create()
    serialpi.wave_send_once(wid)
    while serialpi.wave_tx_busy():
        pass
    serialpi.wave_delete(wid)  



#MODELO FACIL
#ser = rfid.Reader('/dev/ttyS0')
#ser = serial.Serial("/dev/ttyS0",9600,timeout=None)
#id=[]
#c=1





while True:
	
	#Sendline(serialpi)
	while GPIO.input(rxPin):
		#print("SEM DADO")
		#atual=time.time()
		time.sleep(0.00001)
		aviso=aviso+1
		if aviso==20000:
			print("ARMA RETIRADA DO POWER BANK")
			aviso=0		
		#print(time.time()-atual)
		#count_nobyte=count_nobyte+1
		continue
	
	while count_byte<8:
		tempo_inicial = time.time()
		id.append(GPIO.input(rxPin))
		while (time.time()-tempo_inicial<0.0001):
			continue
		count_byte+=1
		
	#	print(time.time()-tempo_inicial)
	count_byte=0

#	print(int(id[0]))
#	print(int(id[1]))
#	print(int(id[2]))
#	print(int(id[3]))
#	print(int(id[4]))
#	print(int(id[5]))
#	print(int(id[6]))
#	print(int(id[7]))
	value_1=2*2*2*2*2*2*2*(int(id[7]))+2*2*2*2*2*2*(int(id[6]))+2*2*2*2*2*(int(id[5]))+2*2*2*2*2*(int(id[5]))+2*2*2*2*(int(id[4]))+2*2*2*(int(id[3]))+2*2*(int(id[2]))+2*(int(id[1]))+(int(id[0]))
	if value_1==4:
		print("ARMA NO POWER BANK")
		




	
	id=[]
	
	time.sleep(1)
	#print(time.time()-tempo_inicial)
 


#r = Reader('/dev/ttyS0')

	#r.start()

#def rfid_uart():

#	if ser.in_waiting:
#       tag = ser.read()
#       if ser.in_waiting:
#		tag = ser.read(13)
#		time.sleep(1)
                #dado_esquerda = ser.in_waiting
#               tag += ser.read()
#		print("ARMA INSERIDA NO POWER BANK")
			

	


	
